{% extends "hidp/base_post_login.html" %}
{% load i18n %}

{% block title %}{% translate 'Manage linked trusted services' %}{% endblock %}

{% block main %}
  <h1>{% translate 'Manage your linked trusted services' %}</h1>

  {% if oidc_error_message %}
  <ul>
    <li>
      {{ oidc_error_message }}
    </li>
  </ul>
  {% endif %}

  {% if successfully_linked_provider %}
  <ul>
    <li>{% blocktranslate trimmed with provider=successfully_linked_provider.name%}
      Successfully linked your {{ provider }} account.
      {% endblocktranslate %}
      <a href="." aria-label="{% translate 'Dismiss' %}">✕</a>
    </li>
  </ul>
  {% elif removed_provider %}
  <ul>
    <li>{% blocktranslate trimmed with provider=removed_provider.name %}
      Successfully unlinked your {{ provider }} account.
      {% endblocktranslate %}
      <a href="." aria-label="{% translate 'Dismiss' %}">✕</a>
    </li>
  </ul>
  {% endif %}

  {% if oidc_linked_providers %}
  <h2>{% translate 'Linked services' %}</h2>
  {% if oidc_linked_providers|length > 1 %}
    {% translate 'Your account is currently linked with the following services:' %}
  {% else %}
    {% translate 'Your account is currently linked with the following service:' %}
  {% endif %}
  {% for item in oidc_linked_providers %}
  <ul>
    <li>
      {{ item.provider.name }}
      {% if can_unlink %}
        <a href="{{ item.url }}" aria-label="{% translate 'Unlink' %}">{% translate 'Unlink' %}</a>
      {% endif %}
    </li>
  </ul>
  {% endfor %}
  {% endif %}

  {% if not can_unlink %}
  <p>
    {% blocktranslate trimmed %}
      Unlinking is currently disabled to prevent you from being locked out.
    {% endblocktranslate %}
  <p>
  {% if oidc_available_providers %}
  <p>
    {% blocktranslate trimmed %}
      To unlink this service, you must either link another service or
      <a href="{{ set_password_url }}">set a password</a> for your account.
    {% endblocktranslate %}
  </p>
  {% else %}
  <p>
    {% blocktranslate trimmed %}
      To unlink this service, you must <a href="{{ set_password_url }}">set a password</a> for your account.
    {% endblocktranslate %}
  </p>
  {% endif %}
  {% endif %}

  {% if oidc_available_providers %}
  <h2>{% translate 'Available services' %}</h2>
  {% for item in oidc_available_providers %}
  <form action="{{ item.url }}" method="POST">
    {% csrf_token %}
    <button type="submit">
      {% blocktranslate trimmed with provider=item.provider.name %}
      Link with {{ provider }}
      {% endblocktranslate %}
    </button>
  </form>
  {% endfor %}
  {% endif %}

  <hr>
  <a href="{% url 'hidp_accounts:manage_account' %}">{% translate 'Back' %}</a>
{% endblock %}
